### 什么是Koa?
Koa 是一个新的 web 框架，由 Express 幕后的原班人马打造， 致力于成为 web 应用和 API 开发领域中的一个更小、更富有表现力、更健壮的基石。 通过利用 async 函数，Koa 帮你丢弃回调函数，并有力地增强错误处理。 **Koa 并没有捆绑任何中间件**， 而是提供了一套优雅的方法，帮助您快速而愉快地编写服务端应用程序。

### Koa核心概念
 + Koa Application (应用程序)
 + Context (上下文)
 + Request (请求),Response (响应)
 
### Koa处理流程
 请求 > Application`koa-router koa-cors ...` >响应
 
### Koa的安装
`npm i -s koa`

index.js:
       
    const Koa =require('koa');
    const app=new Koa();
   
    app.use(ctx=>ctx.body='hello world!!!');
    app.listen(3000);

### ctx对象
    
    { request:
       { method: 'GET',
         url: '/',
         header:
          { host: 'localhost:3000',
            connection: 'keep-alive',
            'cache-control': 'max-age=0',
            'upgrade-insecure-requests': '1',
            'user-agent':
             'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36',
            accept:
             'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3',
            'accept-encoding': 'gzip, deflate, br',
            'accept-language': 'zh-CN,zh;q=0.9',
            cookie:
             'Webstorm-7bb22274=4d6f1a18-7831-4703-a3aa-daeb6152b6ca; Webstorm-6ffb9393=d3e8fa76-06e8-464e-9246-13ab8786f3af; Webstorm-9482aaf4=d3e8fa76-06e8-464e-9246-13ab8786f3af; Phpstorm-328a
    d018=84c533f1-4b8f-4bd7-9517-5271a1f12e4d; Webstorm-a5337cf9=d3e8fa76-06e8-464e-9246-13ab8786f3af' } },
      response:
       { status: 404,
         message: 'Not Found',
         header: [Object: null prototype] {} },
      app: { subdomainOffset: 2, proxy: false, env: 'development' },
      originalUrl: '/',
      req: '<original node req>',
      res: '<original node res>',
      socket: '<original node socket>' }
    { request:
       { method: 'GET',
         url: '/favicon.ico',
         header:
          { host: 'localhost:3000',
            connection: 'keep-alive',
            pragma: 'no-cache',
            'cache-control': 'no-cache',
            'user-agent':
             'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36',
            accept: 'image/webp,image/apng,image/*,*/*;q=0.8',
            referer: 'http://localhost:3000/',
            'accept-encoding': 'gzip, deflate, br',
            'accept-language': 'zh-CN,zh;q=0.9',
            cookie:
             'Webstorm-7bb22274=4d6f1a18-7831-4703-a3aa-daeb6152b6ca; Webstorm-6ffb9393=d3e8fa76-06e8-464e-9246-13ab8786f3af; Webstorm-9482aaf4=d3e8fa76-06e8-464e-9246-13ab8786f3af; Phpstorm-328a
    d018=84c533f1-4b8f-4bd7-9517-5271a1f12e4d; Webstorm-a5337cf9=d3e8fa76-06e8-464e-9246-13ab8786f3af' } },
      response:
       { status: 404,
         message: 'Not Found',
         header: [Object: null prototype] {} },
      app: { subdomainOffset: 2, proxy: false, env: 'development' },
      originalUrl: '/favicon.ico',
      req: '<original node req>',
      res: '<original node res>',
      socket: '<original node socket>' }

### koa-router的使用
`npm i -s koa-router`
    
    const Koa =require('koa');
    const Router = require('koa-router');
    const app=new Koa();
    const router =new Router();
    
    router.get('/',ctx=>ctx.body='hello');
    
    
    //routes():使用所有的路由 allowedMethods():拦截没有的方法
    app.use(router.routes()).use(router.allowedMethods());
    
    app.listen(3000);


### next
在中间件中如果没有next()则不会执行下一个中间件

### Async&Await原理
**async**函数中不一定有**await**
有**await**的函数一定有**async**

    router.get('/async', async ctx => {
      ctx.body =await new Promise((resolve) => setTimeout(() => resolve('hello'), 2000));
    });

### Koa开发RESTful接口
#### Koa中间件
 + 路由:koa-router `npm i -s koa-router`
 + 协议解析: koa-body
 + **测试用**跨域处理: @koa/cors`npm i -s @koa/cors`
 + koa_helmet: 处理安全头
    
    
    const cors= require('@koa/cors');
    const koaBody=require('koa-body');
    
    app.use(koaBody());
    app.use(cors());


#### 开发目录结构
+ 按功能模块进行区分
+ 路由压缩`koa-combine-routes`:app.use过于庞大,进行压缩至use一次
+ 静态资源`koa-static`

        const Koa=require('koa');
        const path= require('path');
        const app=new Koa();
        const helmet = require('koa-helmet');
        const router=require('./router/routes.js');
        const statics=require('koa-static');
        
        app.use(helmet());
        app.use(statics(path.join(__dirname, '../public')));
        app.use(router());
        
        app.listen(3000);

        

### Koa配置开发热加载&webpack配置
+ nodemon:当后端发生变化的时候重启服务器 `npm i -s nodemon` `nodemon src/index.js`

webpack配置:
    `npm install -D webpack webpack-cli clean-webpack-plugin webpack-node-externals @babel/core @babel/node @babel/preset-env babel-loader cross-env`
    
    const path = require('path');
    const nodeExternals = require('webpack-node-externals');
    const {CleanWebpackPlugin} = require('clean-webpack-plugin');
    const webpackConfig = {
      target: 'node',
      mode: 'development',
      entry: {
        server: path.join(__dirname, 'src/index.js')
      },
      output: {
        filename: '[name].bundle.js',
        path: path.join(__dirname, './dist')
      },
      devtool: 'eval-source-map',
      module: {
        rules: [
          {test: /\.(js|jsx)$/, use: {loader: 'babel-loader'}, exclude: [path.join(__dirname, '/node_modules')]}
        ]
      },
      externals: [nodeExternals()],
      plugins: [
        new CleanWebpackPlugin()
      ],
      node: {
        console: true,
        global: true,
        process: true,
        Buffer: true,
        __filename: true,
        __dirname: true,
        setImmediate: true,
        path: true
      }
    };
    module.exports = webpackConfig;

babel配置:
    
    {
      "presets": [
        [
          "@babel/preset-env",
          {
            "targets": {
              "node": "current"
            }
          }
        ]
      ]
    }



### 如何调试webpack配置?
+ console.log
+ `npx node --inspect-brk ./node_modules/.bin/webpack --inline --progress`

